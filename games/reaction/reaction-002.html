<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ‚å¥å¤§å¸ˆ - GameHub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h1 {
            color: #00d9ff;
            font-size: 2rem;
            text-shadow: 0 0 20px rgba(0,217,255,0.5);
        }
        .back-link {
            display: inline-block;
            margin-top: 10px;
            color: #fff;
            text-decoration: none;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s;
        }
        .back-link:hover {
            background: rgba(255,255,255,0.3);
        }
        .game-container {
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
        }
        .score-panel {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .score-item {
            background: rgba(0,217,255,0.1);
            padding: 10px 20px;
            border-radius: 10px;
            color: #fff;
            text-align: center;
            border: 1px solid rgba(0,217,255,0.3);
        }
        .score-item .label {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        .score-item .value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #00d9ff;
        }
        .game-area {
            position: relative;
            height: 400px;
            background: linear-gradient(180deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.5) 100%);
            border-radius: 15px;
            overflow: hidden;
            touch-action: none;
        }
        .lane {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 25%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .lane:nth-child(1) { left: 0; background: rgba(255,100,100,0.1); }
        .lane:nth-child(2) { left: 25%; background: rgba(100,255,100,0.1); }
        .lane:nth-child(3) { left: 50%; background: rgba(100,100,255,0.1); }
        .lane:nth-child(4) { left: 75%; background: rgba(255,255,100,0.1); }
        .hit-zone {
            position: absolute;
            bottom: 30px;
            width: 60%;
            height: 50px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.1s;
            border: 3px solid;
        }
        .lane:nth-child(1) .hit-zone { border-color: #ff6464; background: rgba(255,100,100,0.3); }
        .lane:nth-child(2) .hit-zone { border-color: #64ff64; background: rgba(100,255,100,0.3); }
        .lane:nth-child(3) .hit-zone { border-color: #6464ff; background: rgba(100,100,255,0.3); }
        .lane:nth-child(4) .hit-zone { border-color: #ffff64; background: rgba(255,255,100,0.3); }
        .hit-zone:active, .hit-zone.pressed {
            transform: scale(0.95);
            filter: brightness(1.5);
        }
        .note {
            position: absolute;
            width: 60%;
            height: 40px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            font-weight: bold;
            color: #fff;
            animation: fall linear;
        }
        @keyframes fall {
            from { transform: translateY(-50px); }
            to { transform: translateY(450px); }
        }
        .lane:nth-child(1) .note { background: linear-gradient(145deg, #ff6464, #cc4040); }
        .lane:nth-child(2) .note { background: linear-gradient(145deg, #64ff64, #40cc40); }
        .lane:nth-child(3) .note { background: linear-gradient(145deg, #6464ff, #4040cc); }
        .lane:nth-child(4) .note { background: linear-gradient(145deg, #ffff64, #cccc40); color: #333; }
        .feedback {
            position: absolute;
            font-size: 1.5rem;
            font-weight: bold;
            pointer-events: none;
            animation: feedbackPop 0.5s ease-out forwards;
            z-index: 100;
        }
        @keyframes feedbackPop {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.2); opacity: 0; }
        }
        .feedback.perfect { color: #ffd700; }
        .feedback.good { color: #00ff00; }
        .feedback.miss { color: #ff0000; }
        .combo-display {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #ffd700;
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }
        .message {
            color: #00d9ff;
            font-size: 1.2rem;
            text-align: center;
            margin: 15px 0;
            min-height: 25px;
        }
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        .btn {
            padding: 12px 24px;
            font-size: 1rem;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        .btn-primary {
            background: linear-gradient(145deg, #00d9ff, #0099cc);
            color: #1a1a2e;
        }
        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0,217,255,0.4);
        }
        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: #fff;
        }
        .instructions {
            background: rgba(0,0,0,0.3);
            color: #fff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 0.9rem;
        }
        .instructions h3 {
            color: #00d9ff;
            margin-bottom: 10px;
        }
        .instructions p {
            margin: 5px 0;
        }
        .key-hints {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .key-hint {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
        }
        .key {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 5px;
            font-family: monospace;
            font-weight: bold;
        }
        @media (max-width: 500px) {
            .game-area {
                height: 350px;
            }
            .hit-zone {
                height: 40px;
                font-size: 18px;
            }
            .note {
                height: 35px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸµ èŠ‚å¥å¤§å¸ˆ ğŸµ</h1>
        <a href="../../index.html" class="back-link">â† è¿”å›æ¸¸æˆåˆ—è¡¨</a>
    </div>
    
    <div class="game-container">
        <div class="score-panel">
            <div class="score-item">
                <div class="label">å¾—åˆ†</div>
                <div class="value" id="score">0</div>
            </div>
            <div class="score-item">
                <div class="label">è¿å‡»</div>
                <div class="value" id="combo">0</div>
            </div>
            <div class="score-item">
                <div class="label">å‡†ç¡®ç‡</div>
                <div class="value" id="accuracy">100%</div>
            </div>
        </div>
        
        <div class="message" id="message">ç‚¹å‡»"å¼€å§‹æ¸¸æˆ"</div>
        
        <div class="game-area" id="game-area">
            <div class="lane">
                <div class="hit-zone" data-lane="0">D</div>
            </div>
            <div class="lane">
                <div class="hit-zone" data-lane="1">F</div>
            </div>
            <div class="lane">
                <div class="hit-zone" data-lane="2">J</div>
            </div>
            <div class="lane">
                <div class="hit-zone" data-lane="3">K</div>
            </div>
            <div class="combo-display" id="combo-display"></div>
        </div>
        
        <div class="key-hints">
            <div class="key-hint"><span class="key">D</span> çº¢è‰²</div>
            <div class="key-hint"><span class="key">F</span> ç»¿è‰²</div>
            <div class="key-hint"><span class="key">J</span> è“è‰²</div>
            <div class="key-hint"><span class="key">K</span> é»„è‰²</div>
        </div>
        
        <div class="controls">
            <button class="btn btn-primary" id="start-btn" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
            <button class="btn btn-secondary" onclick="showInstructions()">æ“ä½œè¯´æ˜</button>
        </div>
        
        <div class="instructions" id="instructions" style="display:none;">
            <h3>æ“ä½œè¯´æ˜</h3>
            <p>ğŸµ éŸ³ç¬¦ä»ä¸Šæ–¹è½ä¸‹ï¼Œå½“éŸ³ç¬¦åˆ°è¾¾åº•éƒ¨åŒºåŸŸæ—¶æŒ‰é”®</p>
            <p>âŒ¨ï¸ ä½¿ç”¨é”®ç›˜ Dã€Fã€Jã€K é”®æˆ–ç‚¹å‡»å±å¹•</p>
            <p>âœ¨ Perfect: +100åˆ† | Good: +50åˆ† | Miss: 0åˆ†</p>
            <p>ğŸ”¥ è¿å‡»è¶Šé«˜ï¼Œå¾—åˆ†åŠ æˆè¶Šå¤šï¼</p>
        </div>
    </div>

    <script>
        const gameArea = document.getElementById('game-area');
        const lanes = document.querySelectorAll('.hit-zone');
        
        let score = 0;
        let combo = 0;
        let maxCombo = 0;
        let hits = 0;
        let misses = 0;
        let gameActive = false;
        let noteInterval;
        let notes = [];
        let noteId = 0;
        
        const NOTE_DURATION = 2000; // éŸ³ç¬¦è½ä¸‹æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        const SPAWN_INTERVAL = 600; // ç”Ÿæˆé—´éš”
        const PERFECT_RANGE = 30;   // Perfectåˆ¤å®šèŒƒå›´
        const GOOD_RANGE = 60;      // Goodåˆ¤å®šèŒƒå›´
        
        // é”®ç›˜æ˜ å°„
        const keyMap = {
            'd': 0, 'D': 0,
            'f': 1, 'F': 1,
            'j': 2, 'J': 2,
            'k': 3, 'K': 3
        };
        
        // æŒ‰é”®æŒ‰ä¸‹æ•ˆæœ
        lanes.forEach(lane => {
            lane.addEventListener('mousedown', () => handleInput(parseInt(lane.dataset.lane)));
            lane.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleInput(parseInt(lane.dataset.lane));
            });
        });
        
        document.addEventListener('keydown', (e) => {
            if (keyMap[e.key] !== undefined && gameActive) {
                e.preventDefault();
                const laneIndex = keyMap[e.key];
                lanes[laneIndex].classList.add('pressed');
                handleInput(laneIndex);
            }
        });
        
        document.addEventListener('keyup', (e) => {
            if (keyMap[e.key] !== undefined) {
                lanes[keyMap[e.key]].classList.remove('pressed');
            }
        });
        
        function handleInput(laneIndex) {
            if (!gameActive) return;
            
            // æŸ¥æ‰¾è¯¥è½¨é“æœ€è¿‘çš„å¯åˆ¤å®šéŸ³ç¬¦
            const laneNotes = notes.filter(n => n.lane === laneIndex && !n.hit);
            if (laneNotes.length === 0) return;
            
            // æ‰¾åˆ°æœ€æ¥è¿‘åˆ¤å®šçº¿çš„éŸ³ç¬¦
            const note = laneNotes.reduce((closest, n) => {
                const nDist = Math.abs(n.position - 350);
                const cDist = Math.abs(closest.position - 350);
                return nDist < cDist ? n : closest;
            });
            
            const distance = Math.abs(note.position - 350);
            
            if (distance < PERFECT_RANGE) {
                hitNote(note, 'perfect', laneIndex);
            } else if (distance < GOOD_RANGE) {
                hitNote(note, 'good', laneIndex);
            }
        }
        
        function hitNote(note, quality, laneIndex) {
            note.hit = true;
            
            // ç§»é™¤éŸ³ç¬¦å…ƒç´ 
            if (note.element) {
                note.element.remove();
            }
            
            // æ›´æ–°ç»Ÿè®¡
            hits++;
            combo++;
            if (combo > maxCombo) maxCombo = combo;
            
            // è®¡ç®—å¾—åˆ†ï¼ˆè¿å‡»åŠ æˆï¼‰
            const baseScore = quality === 'perfect' ? 100 : 50;
            const comboBonus = Math.min(combo * 0.1, 2); // æœ€é«˜200%åŠ æˆ
            const earnedScore = Math.floor(baseScore * (1 + comboBonus));
            score += earnedScore;
            
            // æ˜¾ç¤ºåé¦ˆ
            showFeedback(quality, laneIndex);
            updateDisplay();
        }
        
        function missNote(note) {
            if (note.hit) return;
            note.hit = true;
            
            misses++;
            combo = 0;
            
            if (note.element) {
                note.element.style.opacity = '0.3';
            }
            
            showFeedback('miss', note.lane);
            updateDisplay();
        }
        
        function showFeedback(quality, laneIndex) {
            const feedback = document.createElement('div');
            feedback.className = `feedback ${quality}`;
            
            const texts = {
                perfect: 'Perfect!',
                good: 'Good',
                miss: 'Miss'
            };
            feedback.textContent = texts[quality];
            
            const lane = document.querySelectorAll('.lane')[laneIndex];
            const rect = lane.getBoundingClientRect();
            const gameRect = gameArea.getBoundingClientRect();
            
            feedback.style.left = `${rect.left - gameRect.left + rect.width/2 - 40}px`;
            feedback.style.top = '300px';
            
            gameArea.appendChild(feedback);
            
            setTimeout(() => feedback.remove(), 500);
        }
        
        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('combo').textContent = combo;
            
            const total = hits + misses;
            const accuracy = total > 0 ? Math.round((hits / total) * 100) : 100;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
            
            // æ˜¾ç¤ºè¿å‡»
            const comboDisplay = document.getElementById('combo-display');
            if (combo >= 5) {
                comboDisplay.textContent = `${combo} COMBO!`;
                comboDisplay.style.fontSize = `${1 + combo * 0.05}rem`;
            } else {
                comboDisplay.textContent = '';
            }
        }
        
        function spawnNote() {
            const lane = Math.floor(Math.random() * 4);
            const note = {
                id: noteId++,
                lane: lane,
                position: -50,
                hit: false,
                element: null
            };
            
            // åˆ›å»ºéŸ³ç¬¦å…ƒç´ 
            const noteEl = document.createElement('div');
            noteEl.className = 'note';
            noteEl.style.animationDuration = `${NOTE_DURATION}ms`;
            noteEl.textContent = ['D', 'F', 'J', 'K'][lane];
            
            const laneEl = document.querySelectorAll('.lane')[lane];
            laneEl.appendChild(noteEl);
            
            note.element = noteEl;
            notes.push(note);
            
            // è®¾ç½®éŸ³ç¬¦æ¶ˆå¤±
            setTimeout(() => {
                if (!note.hit) {
                    missNote(note);
                }
                // ç§»é™¤éŸ³ç¬¦
                const index = notes.indexOf(note);
                if (index > -1) notes.splice(index, 1);
                if (note.element) note.element.remove();
            }, NOTE_DURATION);
        }
        
        function startGame() {
            // é‡ç½®çŠ¶æ€
            score = 0;
            combo = 0;
            maxCombo = 0;
            hits = 0;
            misses = 0;
            notes = [];
            noteId = 0;
            gameActive = true;
            
            // æ¸…é™¤æ—§éŸ³ç¬¦
            document.querySelectorAll('.note').forEach(n => n.remove());
            document.querySelectorAll('.feedback').forEach(f => f.remove());
            
            updateDisplay();
            document.getElementById('message').textContent = 'æ¸¸æˆè¿›è¡Œä¸­...';
            document.getElementById('start-btn').style.display = 'none';
            
            // å¼€å§‹ç”ŸæˆéŸ³ç¬¦
            noteInterval = setInterval(spawnNote, SPAWN_INTERVAL);
            
            // 30ç§’åç»“æŸæ¸¸æˆ
            setTimeout(endGame, 30000);
        }
        
        function endGame() {
            gameActive = false;
            clearInterval(noteInterval);
            
            // æ¸…é™¤å‰©ä½™éŸ³ç¬¦
            document.querySelectorAll('.note').forEach(n => n.remove());
            notes = [];
            
            const total = hits + misses;
            const accuracy = total > 0 ? Math.round((hits / total) * 100) : 100;
            
            let grade;
            if (accuracy >= 95 && combo >= 20) grade = 'S';
            else if (accuracy >= 85) grade = 'A';
            else if (accuracy >= 70) grade = 'B';
            else if (accuracy >= 50) grade = 'C';
            else grade = 'D';
            
            document.getElementById('message').innerHTML = 
                `æ¸¸æˆç»“æŸï¼ç­‰çº§: <strong>${grade}</strong> | å¾—åˆ†: ${score} | æœ€é«˜è¿å‡»: ${maxCombo}`;
            
            document.getElementById('start-btn').textContent = 'å†æ¥ä¸€å±€';
            document.getElementById('start-btn').style.display = 'inline-block';
            document.getElementById('combo-display').textContent = '';
        }
        
        function showInstructions() {
            const inst = document.getElementById('instructions');
            inst.style.display = inst.style.display === 'none' ? 'block' : 'none';
        }
    </script>
</body>
</html>
